<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>極簡記帳本 PWA</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4f46e5">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .safe-area-inset { padding-top: env(safe-area-inset-top); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-md mx-auto bg-white min-h-screen shadow-lg flex flex-col">
        <!-- Header -->
        <header class="bg-indigo-600 text-white p-6 rounded-b-3xl shadow-lg">
            <h1 class="text-2xl font-bold">我的帳本</h1>
            <div class="mt-4">
                <p class="text-indigo-100 text-sm">當前餘額</p>
                <p id="totalBalance" class="text-4xl font-black mt-1">$ 0</p>
            </div>
        </header>

        <!-- Input Section -->
        <div class="p-6">
            <div class="bg-white rounded-2xl border border-gray-100 p-4 shadow-sm mb-6">
                <div class="space-y-4">
                    <input id="descInput" type="text" placeholder="支出項目 (如：午餐)" class="w-full p-3 bg-gray-50 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500">
                    <input id="amountInput" type="number" placeholder="金額" class="w-full p-3 bg-gray-50 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500">
                    <button onclick="addRecord()" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl hover:bg-indigo-700 transition-colors">新增紀錄</button>
                </div>
            </div>

            <!-- List Section -->
            <h2 class="font-bold text-gray-700 mb-4">最近收支</h2>
            <div id="recordList" class="space-y-3">
                <!-- 紀錄會顯示在這裡 -->
                <p class="text-center text-gray-400 py-10">尚無紀錄</p>
            </div>
        </div>
    </div>

    <script>
        let records = JSON.parse(localStorage.getItem('my_records')) || [];

        function updateUI() {
            const list = document.getElementById('recordList');
            const totalDisplay = document.getElementById('totalBalance');
            list.innerHTML = '';
            
            let total = 0;
            
            if (records.length === 0) {
                list.innerHTML = '<p class="text-center text-gray-400 py-10">尚無紀錄</p>';
            }

            records.forEach((item, index) => {
                total += parseFloat(item.amount);
                const div = document.createElement('div');
                div.className = "flex justify-between items-center p-4 bg-gray-50 rounded-xl";
                div.innerHTML = `
                    <div>
                        <p class="font-medium text-gray-800">${item.description}</p>
                        <p class="text-xs text-gray-400">${item.date}</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="font-bold ${item.amount < 0 ? 'text-red-500' : 'text-green-500'}">
                            ${item.amount > 0 ? '+' : ''}${item.amount}
                        </span>
                        <button onclick="deleteRecord(${index})" class="text-gray-300 hover:text-red-400">✕</button>
                    </div>
                `;
                list.appendChild(div);
            });

            totalDisplay.innerText = `$ ${total.toLocaleString()}`;
            localStorage.setItem('my_records', JSON.stringify(records));
        }

        function addRecord() {
            const desc = document.getElementById('descInput').value;
            const amount = document.getElementById('amountInput').value;

            if (!desc || !amount) return;

            records.unshift({
                description: desc,
                amount: parseFloat(amount),
                date: new Date().toLocaleDateString() + ' ' + new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            });

            document.getElementById('descInput').value = '';
            document.getElementById('amountInput').value = '';
            updateUI();
        }

        function deleteRecord(index) {
            records.splice(index, 1);
            updateUI();
        }

        // 初始化
        updateUI();

        // 註冊 Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker 註冊成功', reg))
                    .catch(err => console.log('Service Worker 註冊失敗', err));
            });
        }
    </script>
</body>
</html>
